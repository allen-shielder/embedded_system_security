嵌入式系统中的低层通信协议

| 协议名称     | 通信模式   | 特点简述                   | 典型用途                |
| -------- | ------ | ---------------------- | ------------------- |
| UART     | 半双工    | 异步通信、点对点、需统一波特率        | 微控制器与模块通信、调试接口      |
| SPI      | 全双工    | 同步通信、主从结构、4根线、支持多从设备   | 存储器、传感器、显示屏等高性能外设通信 |
| I2C      | 多主多从   | 同步通信、两根线（SCL/SDA）、地址寻址 | 低速传感器、EEPROM、RTC    |
| CAN      | 多主多从   | 差分信号、高可靠、实时性强          | 汽车ECU、工业控制、机器人      |
| Ethernet | 全双工    | 高速网络、标准以太网结构           | 局域网、网络通信、视频流        |
| USB      | 主从/OTG | 多种传输方式，支持热插拔，设备类丰富     | U盘、键盘、鼠标、手机         |

通信模式分类

|模式|描述|示例|
|---|---|---|
|Simplex（单工）|单向通信，仅发送或仅接收|键盘 → 电脑显示器|
|Half-Duplex（半双工）|双向通信但不能同时发送接收，通信双方轮流使用通道|对讲机|
|Full-Duplex（全双工）|双向通信，收发可同时进行|电话、SPI、USB|

## 各协议详解

### 1. UART（串口通信）

- **通信线**：TX（发） + RX（收）
    
- **数据帧**：起始位 + 数据位（一般 8 位）+ 可选奇偶校验位 + 停止位
    
- **波特率**：发送/接收速率（如 9600, 115200 bps）
    
- **优点**：简单、通用、远距离支持
    
- **缺点**：无错误检测机制、易受干扰、点对点通信
    
- **安全风险**：可被连接 UART shell，若获取 root 权限可逆向固件、窃取密钥等
    

---

### 2. SPI（串行外设接口）

- **通信线**：MOSI + MISO + SCLK + SS/CS
    
- **同步机制**：主设备发出时钟（SCLK），主从用 CPOL 和 CPHA 控制采样
    
- **特点**：全双工、高速、简单，适合多个外设（但每个都需独立 CS 线）
    
- **缺点**：线数多，不适合远距离通信
    

---

### 3. I2C（集成电路间通信）

- **通信线**：SDA（数据）+ SCL（时钟）
    
- **通信结构**：支持多个主设备、多个从设备；每个从设备有唯一地址（7位或10位）
    
- **通信格式**：起始位 + 地址 + 数据 + ACK/NACK + 停止位
    
- **优点**：结构简单、器件连接方便
    
- **缺点**：速度慢、受电容和长度限制
    
- **漏洞示例**：
    
    - CVE-2019-25162：Linux 内核 use-after-free 漏洞（i2c_unregister_device）
        
    - CVE-2024-26593：阻止未授权事务调用，改善安全
        

---

### 4. CAN（控制器局域网）

- **通信线**：差分信号线 CANH 与 CANL
    
- **架构**：多主、无需中央控制器，使用消息广播与仲裁机制
    
- **帧类型**：
    
    - Data Frame（传输数据）
        
    - Remote Frame（请求数据）
        
    - Error Frame（报错）
        
    - Overload Frame（总线过载）
        
- **优点**：稳定、内建 CRC 校验、实时性高
    
- **缺点**：数据帧较小（8~64字节），实现复杂需专用硬件
    
- **应用**：车载总线、工业控制、机器人、医疗设备
    

---

### 5. Ethernet（以太网）

- **物理层 + 数据链路层协议**，支持 10Mbps ~ 10Gbps
    
- **帧结构**：前导码 + 起始标识符 + MAC地址 + 数据 + FCS（校验序列）
    
- **CSMA/CD 机制**：监听通道空闲才发，冲突后退避重传
    
- **应用**：企业局域网、网络视频、数据中心
    

---

### 6. USB（通用串行总线）

- **结构**：主从架构，但支持 OTG（如手机即当主机又当从机）
    
- **传输类型**：
    
    - 控制传输
        
    - 批量传输（Bulk）
        
    - 中断传输
        
    - 实时传输（Isochronous）
        
- **设备描述符**：包括 Device/Config/Interface/Endpoint 信息
    
- **应用类**：
    
    - HID（键鼠）
        
    - MSD（存储设备）
        
    - Audio/Video（耳机/摄像头）
        
    - CDC/PRN（通信/打印类）
        
- **安全风险**：
    
    - BadUSB 攻击
        
    - USB设备伪装
        
    - 端口注入或侧信道分析攻击




考试提醒与记忆技巧：

| 模块       | 考点提示              | 快速记忆口诀            |
| -------- | ----------------- | ----------------- |
| UART     | 波特率匹配、帧结构、易受攻击    | “起始停位串口谈，误判攻击藏风险” |
| SPI      | 四线传输、CPOL/CPHA    | “主出从入四条线，时钟控制讲同步” |
| I2C      | 多主多从、ACK、漏洞风险     | “两线总线多设备，地址寻址需小心” |
| CAN      | 仲裁机制、帧结构、实时高鲁棒性   | “车载控制靠差分，仲裁广播最聪明” |
| Ethernet | CSMA/CD、MAC地址、帧格式 | “冲突侦测靠监听，局域网络通八方” |
| USB      | 设备类、描述符、安全攻击面大    | “插即用类多样，设备冒充藏隐患”  |

















